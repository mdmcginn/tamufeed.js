var tamufeed=(function(U,L,h,q){var x="0.1.6";var g;var af=[];var s={};var r="tamufeed";var O=tamufeed;var d=O.debugging||false;var n=O.feed||[];var S=O.entries||[];var i=O.language||"en";var F=O.sort||"";var l=O.fetchEntries||4;var P=O.wantEntries||99;var m=O.overWantedClass="over";var u=O.truncatedStringMaxLength||300;var N=O.minutesBeforeHistorical*60000||1800000;var j=O.selector||{};if("string"===typeof j){j={stage:j}}var aa=O.url;if("string"===typeof aa){aa=[aa]}var v=[],D=[],B=[],A=[],ac=[];v.en=["th","st","nd","rd","th","th","th","th","th","th"];v.es=["","","","","","","","","",""];B.en=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];B.es=["Do","Lu","Ma","Mi","Ju","Vi","Sa"];D.en=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];D.es=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"];ac.en=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];ac.es=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];A.en=["January","February","March","April","May","June","July","August","September","October","November","December"];A.es=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];Date.valueOf=Date.now=Date.now||function(){return +new Date};if(console&&typeof console.log=="object"&&Function.prototype.bind){["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(t){console[t]=this.call(console[t],console)},Function.prototype.bind)}if("undefined"===typeof console){console=(function(){z=function(){};return{log:z,trace:z,count:z,dir:z,dirxml:z,debug:z,info:z,warn:z,error:z,group:z,groupCollapsed:z,groupEnd:z,profile:z,profileEnd:z,time:z,timeEnd:z,assert:z}})()}var G=alert||L.error||console.error;var C=function(t){if(d){return console.debug(t)}};j.stage=j.stage||"#tamufeed";j.propertyTemplate=j.propertyTemplate||"#propertyTemplate";j.entryTemplate=j.entryTemplate||"#entryTemplate";j.feedTemplate=j.feedTemplate||"#feedTemplate";j.dateTemplate=j.dateTemplate||"#dateTemplate";j.encasedTemplate=j.encasedTemplate||"#encasedTemplate";j.dateBlockTemplate=j.dateBlockTemplate||"#dateBlockTemplate";var ab=L(j.dateTemplate).html();var p=L(j.propertyTemplate).html();var o=L(j.feedTemplate).html();var H=L(j.entryTemplate).html();var f=L(j.encasedTemplate).html()||'<table class="{{key}}"><tbody><tr><td class="{{key}}" {{dataAttr}}>{{value}}</td></tr></tbody></table>';var w=L(j.dateBlockTemplate).html();if(!aa){aa=["http://codemaroon.tamu.edu/feed.xml"]}var T=function(t,ah){if("string"!==typeof t){throw"t() 1st parameter must be a string; not "+typeof t}for(var ag in ah){t=t.replace(new RegExp("{{"+ag+"}}","g"),ah[ag])}return t.replace(/({{[^{]*}})/ig,"")};var k=function(ao){if(!ao.getMinutes){G("Invalid dt(parameter) was "+typeof ao)}var aj=ao.getMinutes();var aq=ao.getHours();var ap="a.m.";if(aq>=12){aq-=12;ap="p.m.";if(!aq){aq=12}}var ah=ao.getDate();var ag=v[i][ah%10];if(aj<10){aj="0"+aj}var an=(ah<10)?"0"+ah:ah;var al=ao.getDay();var at=B[i][al];var ak=D[i][al];var am=ao.getMonth();var ai=ac[i][am];var ar=A[i][am];am++;var t=(am<=9)?"0"+(am):am;return{w:al,S:ag,j:ah,d:an,D:at,l:ak,n:am,m:t,M:ai,F:ar,Y:ao.getFullYear(),i:aj,g:aq,a:ap,U:ao.getTime()}};var K=function(ah,aj,t){var ai,ag;if("undefined"===typeof aj){aj=u}ai=ah.length>aj;if(!ah||!ai){return ah}if("undefined"===typeof t){t=true}ag=ah.substr(0,aj-1);ag=t?ag.substr(0,ag.lastIndexOf(" ")):ag;return ag+"…"};var a=function(t){if("string"!==typeof t||!t){return""}var ag={"<":"lt",">":"gt",'"':"quot","'":"apos","&":"amp"};return t.replace(/[&<>"']/g,function(ah){return"&"+ag[ah]+";"})};var Q=function(t){if("string"!==typeof t||!t){return""}t=t.replace(/<\/?script/ig,"&lt;script");t=t.replace(/<\/?style/ig,"&lt;style");t=t.replace(/<\/?frameset/ig,"&lt;frameset");t=t.replace(/<\/?iframe/ig,"&lt;iframe");t=t.replace(/<\/?embed/ig,"&lt;embed");t=t.replace(/<\/?object/ig,"&lt;object");return t};var M=function(ag,t){return !!(0.5-Math.random())};var R=function(ag,t){ag="object"===typeof ag.pubDate?ag.pubDate.getTime():0;t="object"===typeof t.pubDate?t.pubDate.getTime():0;return ag>t};var J=function(ag,t){ag="object"===typeof ag.pubDate?ag.pubDate.getTime():0;t="object"===typeof t.pubDate?t.pubDate.getTime():0;return ag<t};var y=function(t,aj,ah,ag){if(!ag){ag=p}var ai="";if("undefined"!==typeof ah){L.each(ah,function(ak,al){ai+=" data-"+ak+'="'+al+'"'})}return !aj?"":T(ag,{key:t,value:aj,dataAttr:ai})};var E=function(ai,am,t){var ak,aj,an,ah,al;var ag=["odd ","even"][ai%2];if(am.type.indexOf("event")>=0){ag+=" vevent"}else{if(am.type.indexOf("person")>=0){ag+=" vcard"}}if(am.historical){ag+=" historical"}C("» viewEntry #"+(ai+1)+" ("+am.type+"), #images="+am.images.length);L.each(am.images,function(ap,ao){C("  img src="+ao.src)});if(am.dtstart){aj=an=y("dtstart",am.dtstart,{iso8601:am.dtstartISO8601});if("Invalid Date"===am.start.toLocaleDateString()){ak=am.publishedDate||am.dstartISO8601}else{ak=T(ab,k(am.start))}al=T(w,k(am.start));if(am.dtend){ah=y("dtend",am.dtend,{iso8601:am.dtendISO8601});aj=aj+"&ndash;"+ah}ak=y("date",ak);aj=ak+aj}else{aj=y("date",T(ab,k(new Date(am.publishedDate))))}return{title:am.title,link:am.link,linkencoded:encodeURIComponent(am.link),tags:"",categories:"",description:am.description,index:ai+1,quantity:t,attributes:ag,dtstart:an,dtend:ah,date:ak,dateBlock:y("dateBlock",al),time:y("time",aj),bookmark:y("bookmark",am.link),subtitle:y("subtitle",am.subtitle),summary:y("summary",am.summary,{},f),location:y("location",am.location),pubDate:y("pubDate",am.publishedDate),author:y("author",am.author)}};var c=function(aj){C("» viewFeed #"+(aj+1));var al=0,ah="",ai=0;var ag=["odd ","even"][aj%2];ag+=" "+n[aj]["type"];var ak=n[aj]["quantity"];if(!ak){ah='<p class="noentry">Nothing to report.</p>';ag+=" empty"}else{for(al;al<n[aj]["quantity"];al++){var t=E(al,S[aj][al],n[aj]["quantity"]);if(t.attributes.indexOf("historical")<1){ai++}if(ai>P){t.attributes+=" "+m}ah+=T(H,t)}}return{feedIndex:"feed"+(aj+1),attributes:ag,index:aj+1,feedQuantity:n.quantity,quantity:ak,entries:ah,feedUrl:n[aj]["feedUrl"],title:n[aj]["title"],author:n[aj]["author"],description:n[aj]["description"]}};var b=function(){C("» View response");L(function(){L.each(aa,function(ag,t){Z(s.stage,T(o,c(ag)));s.stage.attr("data-tamufeed",x)})})};var Z=function(ah,ag,t){C("» putDOM "+(!!t?"overwrite":"append"));if(t){ah.html(ag)}else{ah.append(ag)}};var e=function(aj,ak){C("» modelEntry feed #"+(aj+1)+" entry #"+(ak+1));var ai=af[aj].feed.entries[ak];var al;var ah={publishedDate:ai.publishedDate||0,title:a(K(ai.title)),link:a(K(ai.link)),author:a(K(ai.author))};if(!ai.content){return ah}ah.content=Q(ai.content.replace(/\brel="/ig,' class="'));ah.description=y("description",ah.content);var t=L(ah.description).find(".dtstart");if(t){ah.dtstart=t.text();if("ABBR"===t.prop("tagName")){al="title"}else{al="data-iso8601"}ah.dtstartISO8601=t.attr(al);ah.start=new Date(ah.publishedDate);var ag=L(ah.description).find(".dtend");if(ag){if("ABBR"===ag.prop("tagName")){al="title"}else{al="data-iso8601"}ah.dtend=ag.text();ah.dtendISO8601=ag.attr(al)}}ah.pubDate=new Date(ah.publishedDate);ah.images=L.each(L(ah.description).find("img"),function(an,am){var ap,ao=L(am);am={};am.src=encodeURI(ao.attr("src")||"");if(am.src.indexOf("gravatar.com/avatar")>0){ao.addClass("photo gravatar")}am.clas=a(ao.attr("class"));am.style=a(ao.attr("style"));am.title=a(ao.attr("title"));am.alt=a(ao.attr("alt"))||am.title||am.clas||am.src;am.width=a(ao.attr("width"));am.height=a(ao.attr("height"));ap=am.src.indexOf("feedburner.com/~")>0;if(ap){C("[invalid] "+am.src);am.src="invalid";am=null;return}});ah.location=a(K(L(ah.description).find(".location").text()));ah.fn=a(K(L(ah.description).find(".fn").text()));ah.type="";if(ah.location){ah.type+="event ";ah.historical=ah.start.getTime()<+Date.now()+N;ah.summary=K(L(ah.description).find(".summary").text())}else{if(ah.fn){ah.type+="person ";ah.bday=a(K(L(ah.description).find(".bday").text()));ah.n=Q(K(L(ah.description).find(".n").text()));ah.adr=Q(K(L(ah.description).find(".adr").text()));ah.note=a(K(L(ah.description).find(".note").text()))}else{ah.type+="story ";ah.summary=Q(K(ai.content))}}ah.url=a(K(L(ah.description).find(".url").text()));ah.org=a(K(L(ah.description).find(".org").text()));ah.tel=a(K(L(ah.description).find(".tel").text()));ah.subtitle=a(K(L(ah.description).find(".subtitle").text()));ah.description=y("description",ah.content);return ah};var ad=function(ag){var ai=af[ag].feed.entries.length;C("» modelFeed #"+(ag+1)+" has "+ai+" entries");var t="";var ah=0;S[ag]=[];for(ah;ah<ai;ah++){S[ag][ah]=e(ag,ah);t=S[ag][ah].type}if("shuffle"===F){S[ag].sort(M)}else{if("reverse"===F){if(t.indexOf("event")>=0){S[ag].sort(J)}else{S[ag].sort(R)}}else{if(t.indexOf("event")>=0){S[ag].sort(R)}else{S[ag].sort(J)}}}return{feedUrl:a(K(af[ag].feed.feedUrl)),title:a(K(af[ag].feed.title)),author:a(K(af[ag].feed.author)),description:a(K(af[ag].feed.description)),type:t,quantity:ai}};var I=function(t){C("» controllerFeed #"+(t+1));if(af[t].error){C("- result.error "+af[t].error.code+": "+af[t].error.message);return Z(s.stage,T(o,{feedUrl:"",entries:"",feedIndex:"error"+af[t].error.code,title:"Error "+af[t].error.code+": "+af[t].error.message,description:"Error "+af[t].error.code+": "+af[t].error.message+" in feed #"+t}))}n[t]=ad(t);if(!--n.countdown){b();V()}};var X=function(){if(n.quantity){n.countdown=n.quantity}else{n.quantity=n.countdown=aa.length}C("» controller of request - for "+n.quantity+" feeds");Z(s.stage,"","overwrite");L.each(aa,function(ag,t){if("undefined"!==typeof af[ag]&&"undefined"!==typeof af[ag].error){I(ag)}else{var ah=new g.Feed(t);ah.setNumEntries(l);ah.load(function(ai){Y(ai,ag)})}})};var W=function(ag,t){C("» init");if("undefined"===typeof h){throw"FAIL! google.com/jsapi failed to load before tamufeed.js"}s.stage=L(j.stage);if("undefined"!==typeof h.feeds){ae()}if(s.stage){h.load("feeds","1",{callback:ae,nocss:true})}else{C("INFO: tamufeed.element.stage not found.")}};var V=function(){C("» destroy");af=[];s.stage={}};var ae=function(){C("» putAPI");if("undefined"===typeof h.feeds){C("CRIT: google.feeds failed to initialize.");throw"google.feeds API failure"}g=h.feeds;X()};var Y=function(ag,t){C("» putFeed #"+(t+1));if("undefined"===typeof ag){C("CRIT: google.feeds.load failed to return payload.");throw"google.feeds.load service failure."}af[t]=ag;I(t)};return{VERSION:x,init:W}})(window,$,google);if(typeof define==="function"&&define.amd){define("tamufeed",["jquery","google"],function(b,a){return tamufeed})};